id: monday-board-customer_master_schedule
namespace: company.team
description: "Extract Customer Master Schedule board data from Monday.com (Board ID: 9200517329)"

tasks:
  - id: setup_and_log
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸš€ Starting Workflow: {{ flow.id }}
      ğŸ”— Timestamp: {{ now() }}
      ğŸ“‹ï¸ Namespace: {{ flow.namespace }}
      ğŸ“„ Description: Extract Customer Master Schedule board data from Monday.com (Board ID: 9200517329)
      ğŸ“‚ Script Location: scripts/monday-boards/
      ğŸ—„ï¸ Database Connections: 1

  - id: execute_main_workflow
    type: io.kestra.plugin.core.flow.WorkingDirectory
    description: "Execute {{flow.id}} main script with environment configuration"    
    namespaceFiles:
      enabled: true
      include:
        - scripts/monday-boards/**
        - utils/**
    tasks:
      - id: run_main_script
        type: io.kestra.plugin.scripts.python.Commands
        taskRunner:
          type: io.kestra.plugin.scripts.runner.docker.Docker
          pullPolicy: NEVER
        containerImage: my-custom-kestra:latest
        description: "Execute Customer Master Schedule board extraction for {{flow.id}}"
        namespaceFiles:
          enabled: true
        commands:
          - echo "ğŸš€ === Customer Master Schedule Board Extraction Starting ==="
          - echo "ğŸ“„ Executing board extraction script for {{flow.id}}..."
          - python scripts/monday-boards/get_board_customer_master_schedule.py
          - echo "âœ… === Customer Master Schedule Board Extraction Completed ==="
  - id: completion_log
    type: io.kestra.plugin.core.log.Log
    message: |
      âœ… Workflow completed successfully!
      ğŸ¯ Workflow: {{flow.id}}
      ğŸ“Š Results: Check task outputs above for detailed execution results
      â° Completed at: {{ now() }}
      
  # Monitoring and alerting task
  - id: performance_metrics
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸ“Š === Performance Metrics ===
      ğŸ¯ Workflow: {{flow.id}}
      â±ï¸ Execution Time: {{ taskrun.duration }}
      ğŸ“… Execution Date: {{ now() }}
      ğŸ“‹ Status: {{ taskrun.state.current }}
      ğŸ”„ Run ID: {{ taskrun.id }}
      ğŸ“ˆ Namespace: {{ flow.namespace }}

errors:
  - id: error_notification
    type: io.kestra.plugin.core.log.Log
    message: |
      ğŸš¨ === ERROR ALERT ===
      âŒ Workflow: {{flow.id}} FAILED
      ğŸ“… Failed at: {{ now() }}
      ğŸ” Error: {{ task.outputs }}
      ğŸ”„ Run ID: {{ taskrun.id }}
      ğŸ“§ Alert: Development team notified
      ğŸ¯ Action Required: Check Monday.com API connectivity and script logs

triggers:
  - id: daily_schedule
    type: io.kestra.plugin.core.trigger.Schedule
    cron: "0 2 * * *"  # Daily at 2 AM
    description: Daily extraction of Customer Master Schedule data
